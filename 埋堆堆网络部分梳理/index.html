
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>埋堆堆网络框架梳理 - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              埋堆堆网络框架梳理
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/wzasd/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Jeffrey.wang
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Welcome to MkDocs
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      埋堆堆网络框架梳理
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    My Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/wzasd/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Jeffrey.wang
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome to MkDocs
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          埋堆堆网络框架梳理
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        埋堆堆网络框架梳理
      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.使用例子
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2retrofitservice" class="md-nav__link">
    2.retrofitService
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3networkresource" class="md-nav__link">
    3.NetworkResource
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4baserepositoryparamwrapper" class="md-nav__link">
    4.BaseRepository.paramWrapper
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5.小结
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-faq" class="md-nav__link">
    6. FAQ
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.使用例子
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2retrofitservice" class="md-nav__link">
    2.retrofitService
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3networkresource" class="md-nav__link">
    3.NetworkResource
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4baserepositoryparamwrapper" class="md-nav__link">
    4.BaseRepository.paramWrapper
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5.小结
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-faq" class="md-nav__link">
    6. FAQ
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/wzasd/edit/master/docs/埋堆堆网络部分梳理.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="_1">埋堆堆网络框架梳理<a class="headerlink" href="#_1" title="Anchor link to this section for reference">&para;</a></h1>
<p>本代码基于仓库 <code>branch_4.1.00</code>分析</p>
<h2 id="1">1.使用例子<a class="headerlink" href="#1" title="Anchor link to this section for reference">&para;</a></h2>
<p>首先是日常使用的最简单的例子：</p>
<ol>
<li>Api 接口的定义</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos="1 "></span></a><span class="kd">interface</span> <span class="nc">ApiService</span> <span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos="2 "></span></a>        <span class="nd">@POST</span><span class="p">(</span><span class="n">ApiURL</span><span class="p">.</span><span class="na">GET_SPLASH_IMAGE</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos="3 "></span></a>        <span class="n">LiveData</span><span class="o">&lt;</span><span class="n">ApiResponse</span><span class="o">&lt;</span><span class="n">ResponseModel</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">SplashModel</span><span class="o">&gt;&gt;&gt;&gt;</span><span class="n">getSplashImageTask</span><span class="p">(</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos="4 "></span></a>      <span class="nd">@Body</span> <span class="n">RequestParam</span><span class="o">&lt;</span><span class="n">NoneParam</span><span class="o">&gt;</span> <span class="n">requestParam</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos="5 "></span></a>    <span class="p">);</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos="6 "></span></a><span class="p">}</span>
</code></pre></div>
<ol>
<li>使用 LiveData 来发送网络请求</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kd">class</span> <span class="nc">Reposititry</span><span class="p">:</span> <span class="n">BaseReository</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos=" 2 "></span></a>  <span class="kd">fun</span> <span class="nf">getSplashImageIage</span><span class="p">(</span><span class="n">dataParam</span><span class="p">:</span> <span class="n">NoneParam?)</span><span class="p">:</span> <span class="n">LiveData</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">SplashModel?&gt;</span><span class="o">?&gt;&gt;</span><span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="kd">val</span> <span class="nv">requestParam</span> <span class="o">=</span> <span class="n">paraWrapper</span><span class="p">(</span><span class="n">ApiURL</span><span class="p">.</span><span class="na">GET_SPLASH_IMAGE</span><span class="p">,</span><span class="n">dataParam</span><span class="p">)</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="k">return</span> <span class="k">object</span> <span class="p">:</span> <span class="nc">NetworkResource</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">SplashModel?&gt;</span><span class="o">?&gt;</span><span class="p">(){</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos=" 5 "></span></a>      <span class="kd">override</span> <span class="kd">fun</span> <span class="nf">createCall</span><span class="p">():</span> <span class="n">LiveData</span><span class="o">&lt;</span><span class="n">ApiResponse</span><span class="o">&lt;</span><span class="n">ResponseModel</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">SplashModel?&gt;</span><span class="o">?&gt;&gt;&gt;</span> <span class="p">{</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="k">return</span> <span class="n">retrofitService</span><span class="p">.</span><span class="na">getSplashImageTask</span><span class="p">(</span><span class="n">requestParam</span><span class="p">)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos=" 7 "></span></a>      <span class="p">}</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="p">}.</span><span class="na">asLiveData</span><span class="p">()</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><a href="#__codelineno-1-9"><span class="linenos" data-linenos=" 9 "></span></a>  <span class="p">}</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><a href="#__codelineno-1-10"><span class="linenos" data-linenos="10 "></span></a><span class="p">}</span>
</code></pre></div>
<p>在正式开始之前，介绍几个基础的类方便备忘：</p>
<ul>
<li>httpService</li>
<li>ApiResponse</li>
<li>RetrofitService</li>
<li>NetworkResource</li>
<li>BaseRepositoryLab</li>
<li>BaseViewModel</li>
<li>RetrofitDelegate</li>
</ul>
<h2 id="2retrofitservice">2.retrofitService<a class="headerlink" href="#2retrofitservice" title="Anchor link to this section for reference">&para;</a></h2>
<p>我们先来跟进这个方法，看看在是怎么获取到<code>RetrofitService</code>这个实体方法的。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BaseRepository</span> <span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a>    <span class="n">RetrofitService</span> <span class="nf">getRetrofitService</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a>        <span class="k">return</span> <span class="n">HttpService</span><span class="p">.</span><span class="na">getRetrofitService</span><span class="p">();</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><a href="#__codelineno-2-4"><span class="linenos" data-linenos="4 "></span></a>    <span class="p">}</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><a href="#__codelineno-2-5"><span class="linenos" data-linenos="5 "></span></a><span class="p">}</span>
</code></pre></div>
<p>这里通过<code>HttpService</code>来获取具体的<code>Retrofit</code>的实例</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpService</span> <span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos=" 2 "></span></a>        <span class="p">...</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos=" 3 "></span></a>      <span class="n">public</span> <span class="n">static</span> <span class="n">RetrofitService</span> <span class="n">getRetrofitService</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos=" 4 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">retrofitService</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos=" 5 "></span></a>            <span class="n">retrofitService</span> <span class="o">=</span> <span class="n">RetrofitDelegate</span><span class="p">.</span><span class="na">create</span><span class="p">(</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos=" 6 "></span></a>                    <span class="n">new</span> <span class="n">Retrofit</span><span class="p">.</span><span class="na">Builder</span><span class="p">().</span><span class="na">baseUrl</span><span class="p">(</span><span class="n">ApiURL</span><span class="p">.</span><span class="na">BASE_URL</span><span class="p">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos=" 7 "></span></a>                    <span class="p">.</span><span class="na">addConverterFactory</span><span class="p">(</span><span class="n">GsonConverterFactory</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">GsonFactory</span><span class="p">.</span><span class="na">getSingletonGson</span><span class="p">()))</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos=" 8 "></span></a>                    <span class="p">.</span><span class="na">addCallAdapterFactory</span><span class="p">(</span><span class="n">new</span> <span class="n">LiveDataCallAdapterFactory</span><span class="p">())</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos=" 9 "></span></a>                    <span class="p">.</span><span class="na">client</span><span class="p">(</span><span class="n">createOkHttpClient</span><span class="p">())</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><a href="#__codelineno-3-10"><span class="linenos" data-linenos="10 "></span></a>                    <span class="p">.</span><span class="na">build</span><span class="p">().</span><span class="na">create</span><span class="p">(</span><span class="n">RetrofitService</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><a href="#__codelineno-3-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="p">}</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><a href="#__codelineno-3-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="k">return</span> <span class="n">retrofitService</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><a href="#__codelineno-3-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="p">}</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><a href="#__codelineno-3-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="p">...</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><a href="#__codelineno-3-15"><span class="linenos" data-linenos="15 "></span></a><span class="p">}</span>
</code></pre></div>
<p>基本就是正常的创建<code>Retrofit</code>的创建过程来获取具体 <code>Retrofit</code>的方法。</p>
<p>PS:这里建议直接使用依赖注入的方式进行注册，减少模板代码以及多线程重复创建问题。</p>
<p>这里主要是三个自定义的文件：</p>
<ul>
<li><code>addConverterFactory（GsonConverterFactory.create(GsonFactory.getSingletonGson())）</code></li>
<li><code>addCallAdapterFactory（new LiveDataCallAdapterFactory()）</code></li>
<li><code>client（createOkHttpClient()）</code></li>
</ul>
<p>首先来看 <code>createOkHttpClient</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos=" 1 "></span></a>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">OkHttpClient</span> <span class="nf">createOkHttpClient</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos=" 2 "></span></a>        <span class="c1">//Headers拦截器</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos=" 3 "></span></a>        <span class="n">Interceptor</span> <span class="n">headersInterceptor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Interceptor</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos=" 4 "></span></a>            <span class="nd">@Override</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos=" 5 "></span></a>            <span class="kd">public</span> <span class="n">Response</span> <span class="nf">intercept</span><span class="p">(</span><span class="n">Chain</span> <span class="n">chain</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="p">{</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><a href="#__codelineno-4-6"><span class="linenos" data-linenos=" 6 "></span></a>                <span class="n">Request</span> <span class="n">original</span> <span class="o">=</span> <span class="n">chain</span><span class="p">.</span><span class="na">request</span><span class="p">();</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><a href="#__codelineno-4-7"><span class="linenos" data-linenos=" 7 "></span></a>                <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="n">original</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><a href="#__codelineno-4-8"><span class="linenos" data-linenos=" 8 "></span></a>                        <span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">&quot;version&quot;</span><span class="p">,</span> <span class="n">BuildConfig</span><span class="p">.</span><span class="na">VERSION_NAME</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><a href="#__codelineno-4-9"><span class="linenos" data-linenos=" 9 "></span></a>                        <span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">&quot;Referer&quot;</span><span class="p">,</span><span class="s">&quot;mdd&quot;</span><span class="p">)</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><a href="#__codelineno-4-10"><span class="linenos" data-linenos="10 "></span></a>                        <span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">&quot;User-Agent&quot;</span><span class="p">,</span><span class="s">&quot;Mdd/&quot;</span><span class="o">+</span><span class="n">BuildConfig</span><span class="p">.</span><span class="na">VERSION_NAME</span><span class="o">+</span><span class="s">&quot; (Android+&quot;</span><span class="o">+</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="o">+</span><span class="s">&quot;+)&quot;</span><span class="p">)</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><a href="#__codelineno-4-11"><span class="linenos" data-linenos="11 "></span></a>                        <span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><a href="#__codelineno-4-12"><span class="linenos" data-linenos="12 "></span></a>                <span class="k">return</span> <span class="n">chain</span><span class="p">.</span><span class="na">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><a href="#__codelineno-4-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="p">}</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><a href="#__codelineno-4-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="p">};</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><a href="#__codelineno-4-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="c1">//在测试模式下，是否开启Chuck抓包</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><a href="#__codelineno-4-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="kt">boolean</span> <span class="n">isOpenDebug</span> <span class="o">=</span> <span class="n">SPUtils</span><span class="p">.</span><span class="na">getBoolean</span><span class="p">(</span><span class="n">SpConstant</span><span class="p">.</span><span class="na">IS_OPEN_HTTP_LOG</span><span class="p">,</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><a href="#__codelineno-4-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><a href="#__codelineno-4-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="c1">//定制OkHttp</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><a href="#__codelineno-4-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">OkHttpClient</span><span class="p">.</span><span class="na">Builder</span> <span class="n">httpClientBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="p">.</span><span class="na">Builder</span><span class="p">();</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a><a href="#__codelineno-4-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><a href="#__codelineno-4-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">httpClientBuilder</span> <span class="o">=</span> <span class="n">httpClientBuilder</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a><a href="#__codelineno-4-22"><span class="linenos" data-linenos="22 "></span></a>                <span class="p">.</span><span class="na">connectTimeout</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">)</span><span class="c1">//设置连接超时时间</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><a href="#__codelineno-4-23"><span class="linenos" data-linenos="23 "></span></a>                <span class="p">.</span><span class="na">readTimeout</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span><span class="c1">//设置读取超时时间</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a><a href="#__codelineno-4-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="c1">//OkHttp添加拦截器</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><a href="#__codelineno-4-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="c1">//httpClientBuilder.addInterceptor(headersInterceptor);</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a><a href="#__codelineno-4-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">BuildConfig</span><span class="p">.</span><span class="na">IS_LOG</span><span class="p">){</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a><a href="#__codelineno-4-27"><span class="linenos" data-linenos="27 "></span></a>            <span class="c1">//Log拦截器</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a><a href="#__codelineno-4-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="n">HttpLogInterceptor</span> <span class="n">logInterceptor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpLogInterceptor</span><span class="p">(</span><span class="k">new</span> <span class="n">HttpLogInterceptor</span><span class="p">.</span><span class="na">Logger</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a><a href="#__codelineno-4-29"><span class="linenos" data-linenos="29 "></span></a>                <span class="nd">@Override</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a><a href="#__codelineno-4-30"><span class="linenos" data-linenos="30 "></span></a>                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">log</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a><a href="#__codelineno-4-31"><span class="linenos" data-linenos="31 "></span></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">TextUtils</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">message</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a><a href="#__codelineno-4-32"><span class="linenos" data-linenos="32 "></span></a>                        <span class="k">return</span><span class="p">;</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a><a href="#__codelineno-4-33"><span class="linenos" data-linenos="33 "></span></a>                    <span class="p">}</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a><a href="#__codelineno-4-34"><span class="linenos" data-linenos="34 "></span></a>                    <span class="kt">int</span> <span class="n">segmentSize</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a><a href="#__codelineno-4-35"><span class="linenos" data-linenos="35 "></span></a>                    <span class="kt">long</span> <span class="n">length</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="na">length</span><span class="p">();</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a><a href="#__codelineno-4-36"><span class="linenos" data-linenos="36 "></span></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="n">segmentSize</span> <span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a><a href="#__codelineno-4-37"><span class="linenos" data-linenos="37 "></span></a>                        <span class="c1">// 长度小于等于限制直接打印</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a><a href="#__codelineno-4-38"><span class="linenos" data-linenos="38 "></span></a>                        <span class="n">Log</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a><a href="#__codelineno-4-39"><span class="linenos" data-linenos="39 "></span></a>                        <span class="k">return</span><span class="p">;</span>
<a id="__codelineno-4-40" name="__codelineno-4-40"></a><a href="#__codelineno-4-40"><span class="linenos" data-linenos="40 "></span></a>                    <span class="p">}</span>
<a id="__codelineno-4-41" name="__codelineno-4-41"></a><a href="#__codelineno-4-41"><span class="linenos" data-linenos="41 "></span></a>                    <span class="c1">// 循环分段打印日志</span>
<a id="__codelineno-4-42" name="__codelineno-4-42"></a><a href="#__codelineno-4-42"><span class="linenos" data-linenos="42 "></span></a>                    <span class="k">while</span> <span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">segmentSize</span> <span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-4-43" name="__codelineno-4-43"></a><a href="#__codelineno-4-43"><span class="linenos" data-linenos="43 "></span></a>                        <span class="n">String</span> <span class="n">logContent</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">segmentSize</span> <span class="p">);</span>
<a id="__codelineno-4-44" name="__codelineno-4-44"></a><a href="#__codelineno-4-44"><span class="linenos" data-linenos="44 "></span></a>                        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="n">logContent</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-4-45" name="__codelineno-4-45"></a><a href="#__codelineno-4-45"><span class="linenos" data-linenos="45 "></span></a>                        <span class="n">Log</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="n">logContent</span><span class="p">);</span>
<a id="__codelineno-4-46" name="__codelineno-4-46"></a><a href="#__codelineno-4-46"><span class="linenos" data-linenos="46 "></span></a>                    <span class="p">}</span>
<a id="__codelineno-4-47" name="__codelineno-4-47"></a><a href="#__codelineno-4-47"><span class="linenos" data-linenos="47 "></span></a>                    <span class="c1">// 打印剩余日志</span>
<a id="__codelineno-4-48" name="__codelineno-4-48"></a><a href="#__codelineno-4-48"><span class="linenos" data-linenos="48 "></span></a>                    <span class="n">Log</span><span class="p">.</span><span class="na">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
<a id="__codelineno-4-49" name="__codelineno-4-49"></a><a href="#__codelineno-4-49"><span class="linenos" data-linenos="49 "></span></a>                <span class="p">}</span>
<a id="__codelineno-4-50" name="__codelineno-4-50"></a><a href="#__codelineno-4-50"><span class="linenos" data-linenos="50 "></span></a>            <span class="p">});</span>
<a id="__codelineno-4-51" name="__codelineno-4-51"></a><a href="#__codelineno-4-51"><span class="linenos" data-linenos="51 "></span></a>            <span class="c1">//日志显示级别</span>
<a id="__codelineno-4-52" name="__codelineno-4-52"></a><a href="#__codelineno-4-52"><span class="linenos" data-linenos="52 "></span></a>            <span class="n">logInterceptor</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">HttpLogInterceptor</span><span class="p">.</span><span class="na">Level</span><span class="p">.</span><span class="na">BODY</span><span class="p">);</span>
<a id="__codelineno-4-53" name="__codelineno-4-53"></a><a href="#__codelineno-4-53"><span class="linenos" data-linenos="53 "></span></a>            <span class="n">httpClientBuilder</span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="n">logInterceptor</span><span class="p">);</span>
<a id="__codelineno-4-54" name="__codelineno-4-54"></a><a href="#__codelineno-4-54"><span class="linenos" data-linenos="54 "></span></a>        <span class="p">}</span>
<a id="__codelineno-4-55" name="__codelineno-4-55"></a><a href="#__codelineno-4-55"><span class="linenos" data-linenos="55 "></span></a>        <span class="c1">//测试模式下才加入请求拦截</span>
<a id="__codelineno-4-56" name="__codelineno-4-56"></a><a href="#__codelineno-4-56"><span class="linenos" data-linenos="56 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">BuildConfig</span><span class="p">.</span><span class="na">IS_LOG</span> <span class="o">&amp;&amp;</span> <span class="n">isOpenDebug</span><span class="p">){</span>
<a id="__codelineno-4-57" name="__codelineno-4-57"></a><a href="#__codelineno-4-57"><span class="linenos" data-linenos="57 "></span></a>            <span class="n">httpClientBuilder</span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="k">new</span> <span class="n">ChuckInterceptor</span><span class="p">(</span><span class="n">MddApplication</span><span class="p">.</span><span class="na">app</span><span class="p">));</span>
<a id="__codelineno-4-58" name="__codelineno-4-58"></a><a href="#__codelineno-4-58"><span class="linenos" data-linenos="58 "></span></a>        <span class="p">}</span>
<a id="__codelineno-4-59" name="__codelineno-4-59"></a><a href="#__codelineno-4-59"><span class="linenos" data-linenos="59 "></span></a>        <span class="c1">//noAuthHttps(httpClientBuilder);</span>
<a id="__codelineno-4-60" name="__codelineno-4-60"></a><a href="#__codelineno-4-60"><span class="linenos" data-linenos="60 "></span></a>        <span class="c1">//加入head</span>
<a id="__codelineno-4-61" name="__codelineno-4-61"></a><a href="#__codelineno-4-61"><span class="linenos" data-linenos="61 "></span></a>        <span class="n">httpClientBuilder</span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="n">headersInterceptor</span><span class="p">);</span>
<a id="__codelineno-4-62" name="__codelineno-4-62"></a><a href="#__codelineno-4-62"><span class="linenos" data-linenos="62 "></span></a>
<a id="__codelineno-4-63" name="__codelineno-4-63"></a><a href="#__codelineno-4-63"><span class="linenos" data-linenos="63 "></span></a>        <span class="n">okHttpClient</span> <span class="o">=</span> <span class="n">httpClientBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<a id="__codelineno-4-64" name="__codelineno-4-64"></a><a href="#__codelineno-4-64"><span class="linenos" data-linenos="64 "></span></a>        <span class="k">return</span> <span class="n">okHttpClient</span><span class="p">;</span>
<a id="__codelineno-4-65" name="__codelineno-4-65"></a><a href="#__codelineno-4-65"><span class="linenos" data-linenos="65 "></span></a>    <span class="p">}</span>
</code></pre></div>
<p>自己定制的 <code>OkhttpClient</code>基本都是一些私有订制的属性。</p>
<ol>
<li><code>addConverterFactory（GsonConverterFactory.create(GsonFactory.getSingletonGson())）</code></li>
</ol>
<p>这里使用了 Gson 解析的容错适配器，地址在<a href="http://git.mddcloud.com.cn/HJQ/MddGsonFactory">MddGsonFactory</a>，防止后端 Api 不够标准的容错机制</p>
<ol>
<li><code>addCallAdapterFactory(new LiveDataCallAdapterFactory())</code></li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LiveDataCallAdapterFactory</span> <span class="kd">extends</span> <span class="n">CallAdapter</span><span class="p">.</span><span class="na">Factory</span> <span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="nd">@Override</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="kd">public</span> <span class="n">CallAdapter</span><span class="o">&lt;?</span><span class="p">,</span> <span class="o">?&gt;</span> <span class="n">get</span><span class="p">(</span><span class="n">Type</span> <span class="n">returnType</span><span class="p">,</span> <span class="n">Annotation</span><span class="o">[]</span> <span class="n">annotations</span><span class="p">,</span> <span class="n">Retrofit</span> <span class="n">retrofit</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">getRawType</span><span class="p">(</span><span class="n">returnType</span><span class="p">)</span> <span class="o">!=</span> <span class="n">LiveData</span><span class="p">.</span><span class="na">class</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><a href="#__codelineno-5-6"><span class="linenos" data-linenos=" 6 "></span></a>            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><a href="#__codelineno-5-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="p">}</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><a href="#__codelineno-5-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">Type</span> <span class="n">observableType</span> <span class="o">=</span> <span class="n">getParameterUpperBound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">ParameterizedType</span><span class="p">)</span> <span class="n">returnType</span><span class="p">);</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><a href="#__codelineno-5-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">rawObservableType</span> <span class="o">=</span> <span class="n">getRawType</span><span class="p">(</span><span class="n">observableType</span><span class="p">);</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><a href="#__codelineno-5-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">rawObservableType</span> <span class="o">!=</span> <span class="n">ApiResponse</span><span class="p">.</span><span class="na">class</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><a href="#__codelineno-5-11"><span class="linenos" data-linenos="11 "></span></a>            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;type must be a resource&quot;</span><span class="p">);</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><a href="#__codelineno-5-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="p">}</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><a href="#__codelineno-5-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="n">observableType</span> <span class="k">instanceof</span> <span class="n">ParameterizedType</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><a href="#__codelineno-5-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;resource must be parameterized&quot;</span><span class="p">);</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><a href="#__codelineno-5-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="p">}</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><a href="#__codelineno-5-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">Type</span> <span class="n">bodyType</span> <span class="o">=</span> <span class="n">getParameterUpperBound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">ParameterizedType</span><span class="p">)</span> <span class="n">observableType</span><span class="p">);</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><a href="#__codelineno-5-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="k">return</span> <span class="k">new</span> <span class="n">LiveDataCallAdapter</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">bodyType</span><span class="p">);</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><a href="#__codelineno-5-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="p">}</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><a href="#__codelineno-5-19"><span class="linenos" data-linenos="19 "></span></a><span class="p">}</span>
</code></pre></div>
<p>使用<code>LiveData</code>适配器做了转换处理。</p>
<h2 id="3networkresource">3.NetworkResource<a class="headerlink" href="#3networkresource" title="Anchor link to this section for reference">&para;</a></h2>
<p>可以看到在发送网络请求的时候，对此类进行返回，这里是将网络请求的回调数据进行预处理，采用了抽象方法，并把主要 <code>careateCall</code>方法暴露出来，来跟上一步进行衔接，获取网络数据后进行数据预处理。具体代码如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">NetworkResource</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><a href="#__codelineno-6-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MediatorLiveData</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MediatorLiveData</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><a href="#__codelineno-6-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><a href="#__codelineno-6-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="nd">@MainThread</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><a href="#__codelineno-6-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="kd">public</span> <span class="nf">NetworkResource</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><a href="#__codelineno-6-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="n">result</span><span class="p">.</span><span class="na">setValue</span><span class="p">((</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">Resource</span><span class="p">.</span><span class="na">loading</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="n">getRequestParam</span><span class="p">()));</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><a href="#__codelineno-6-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">fetchFromNetwork</span><span class="p">();</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><a href="#__codelineno-6-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="p">}</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><a href="#__codelineno-6-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><a href="#__codelineno-6-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="nd">@MainThread</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><a href="#__codelineno-6-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="p">(</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">newValue</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><a href="#__codelineno-6-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getValue</span><span class="p">(),</span> <span class="n">newValue</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><a href="#__codelineno-6-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="n">result</span><span class="p">.</span><span class="na">setValue</span><span class="p">(</span><span class="n">newValue</span><span class="p">);</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><a href="#__codelineno-6-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="p">}</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><a href="#__codelineno-6-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="p">}</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><a href="#__codelineno-6-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><a href="#__codelineno-6-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">fetchFromNetwork</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><a href="#__codelineno-6-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="kd">final</span> <span class="n">LiveData</span><span class="o">&lt;</span><span class="n">ApiResponse</span><span class="o">&lt;</span><span class="n">ResponseModel</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span> <span class="n">apiResponse</span> <span class="o">=</span> <span class="n">createCall</span><span class="p">();</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><a href="#__codelineno-6-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">result</span><span class="p">.</span><span class="na">addSource</span><span class="p">(</span><span class="n">apiResponse</span><span class="p">,</span> <span class="k">new</span> <span class="n">Observer</span><span class="o">&lt;</span><span class="n">ApiResponse</span><span class="o">&lt;</span><span class="n">ResponseModel</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><a href="#__codelineno-6-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="nd">@Override</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><a href="#__codelineno-6-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onChanged</span><span class="p">(</span><span class="nd">@Nullable</span> <span class="kd">final</span> <span class="n">ApiResponse</span><span class="o">&lt;</span><span class="n">ResponseModel</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">requestTypeApiResponse</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><a href="#__codelineno-6-22"><span class="linenos" data-linenos="22 "></span></a>                <span class="n">result</span><span class="p">.</span><span class="na">removeSource</span><span class="p">(</span><span class="n">apiResponse</span><span class="p">);</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><a href="#__codelineno-6-23"><span class="linenos" data-linenos="23 "></span></a>                <span class="kd">final</span> <span class="n">ResponseModel</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">responseModel</span> <span class="o">=</span> <span class="n">requestTypeApiResponse</span><span class="p">.</span><span class="na">body</span><span class="p">;</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><a href="#__codelineno-6-24"><span class="linenos" data-linenos="24 "></span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">requestTypeApiResponse</span><span class="p">.</span><span class="na">isSuccessful</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="kc">null</span> <span class="o">!=</span> <span class="n">responseModel</span> <span class="o">&amp;&amp;</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">isSuccessful</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><a href="#__codelineno-6-25"><span class="linenos" data-linenos="25 "></span></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">responseModel</span><span class="p">.</span><span class="na">getActivityData</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getActivityData</span><span class="p">().</span><span class="na">getTaskInfo</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><a href="#__codelineno-6-26"><span class="linenos" data-linenos="26 "></span></a>                        <span class="c1">//活动任务完成提示</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><a href="#__codelineno-6-27"><span class="linenos" data-linenos="27 "></span></a>                        <span class="n">TaskResultEvent</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="n">responseModel</span><span class="p">.</span><span class="na">getActivityData</span><span class="p">());</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><a href="#__codelineno-6-28"><span class="linenos" data-linenos="28 "></span></a>                    <span class="p">}</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><a href="#__codelineno-6-29"><span class="linenos" data-linenos="29 "></span></a>                    <span class="n">setValue</span><span class="p">(</span><span class="n">Resource</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">requestTypeApiResponse</span><span class="p">,</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getMsg</span><span class="p">(),</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getMsgType</span><span class="p">(),</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getData</span><span class="p">(),</span> <span class="n">getRequestParam</span><span class="p">()));</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><a href="#__codelineno-6-30"><span class="linenos" data-linenos="30 "></span></a>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><a href="#__codelineno-6-31"><span class="linenos" data-linenos="31 "></span></a>                    <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">responseModel</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><a href="#__codelineno-6-32"><span class="linenos" data-linenos="32 "></span></a>                        <span class="kt">boolean</span> <span class="n">isConnect</span> <span class="o">=</span> <span class="n">NetworkUtils</span><span class="p">.</span><span class="na">isNetworkConnected</span><span class="p">(</span><span class="n">MddApplication</span><span class="p">.</span><span class="na">getApp</span><span class="p">());</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a><a href="#__codelineno-6-33"><span class="linenos" data-linenos="33 "></span></a>                        <span class="c1">//判断是不是网络错误</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a><a href="#__codelineno-6-34"><span class="linenos" data-linenos="34 "></span></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">isConnect</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a><a href="#__codelineno-6-35"><span class="linenos" data-linenos="35 "></span></a>                            <span class="n">setValue</span><span class="p">(</span><span class="n">Resource</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">requestTypeApiResponse</span><span class="p">,</span> <span class="s">&quot;服务器出错，请稍后重试&quot;</span><span class="p">,</span> <span class="n">getRequestParam</span><span class="p">()));</span>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><a href="#__codelineno-6-36"><span class="linenos" data-linenos="36 "></span></a>                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><a href="#__codelineno-6-37"><span class="linenos" data-linenos="37 "></span></a>                            <span class="n">setValue</span><span class="p">(</span><span class="n">Resource</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">requestTypeApiResponse</span><span class="p">,</span> <span class="n">ResponseCode</span><span class="p">.</span><span class="na">ERROR_NO_NETWORK</span><span class="p">,</span> <span class="s">&quot;似乎已断开网络连接，请检查网络&quot;</span><span class="p">,</span> <span class="n">getRequestParam</span><span class="p">()));</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a><a href="#__codelineno-6-38"><span class="linenos" data-linenos="38 "></span></a>                        <span class="p">}</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a><a href="#__codelineno-6-39"><span class="linenos" data-linenos="39 "></span></a>                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">responseModel</span><span class="p">.</span><span class="na">getMsgType</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getMsgType</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">99</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a><a href="#__codelineno-6-40"><span class="linenos" data-linenos="40 "></span></a>                        <span class="c1">//Token过期打点通知事件</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a><a href="#__codelineno-6-41"><span class="linenos" data-linenos="41 "></span></a>                        <span class="n">TokenExpireEvent</span> <span class="n">expireEvent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TokenExpireEvent</span><span class="p">();</span>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a><a href="#__codelineno-6-42"><span class="linenos" data-linenos="42 "></span></a>                        <span class="n">expireEvent</span><span class="p">.</span><span class="na">setRequestURL</span><span class="p">(</span><span class="n">requestTypeApiResponse</span><span class="p">.</span><span class="na">requestURL</span><span class="p">);</span>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a><a href="#__codelineno-6-43"><span class="linenos" data-linenos="43 "></span></a>                        <span class="n">expireEvent</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="n">responseModel</span><span class="p">.</span><span class="na">getMsgType</span><span class="p">());</span>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a><a href="#__codelineno-6-44"><span class="linenos" data-linenos="44 "></span></a>                        <span class="n">expireEvent</span><span class="p">.</span><span class="na">setErrorMessage</span><span class="p">(</span><span class="n">responseModel</span><span class="p">.</span><span class="na">getMsg</span><span class="p">());</span>
<a id="__codelineno-6-45" name="__codelineno-6-45"></a><a href="#__codelineno-6-45"><span class="linenos" data-linenos="45 "></span></a>                        <span class="n">TokenExpireEvent</span><span class="p">.</span><span class="na">post</span><span class="p">(</span><span class="n">expireEvent</span><span class="p">);</span>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a><a href="#__codelineno-6-46"><span class="linenos" data-linenos="46 "></span></a>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a><a href="#__codelineno-6-47"><span class="linenos" data-linenos="47 "></span></a>                        <span class="n">setValue</span><span class="p">(</span><span class="n">Resource</span><span class="p">.</span><span class="na">tokenExpired</span><span class="p">(</span><span class="n">requestTypeApiResponse</span><span class="p">,</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getData</span><span class="p">(),</span> <span class="n">getRequestParam</span><span class="p">()));</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a><a href="#__codelineno-6-48"><span class="linenos" data-linenos="48 "></span></a>                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a><a href="#__codelineno-6-49"><span class="linenos" data-linenos="49 "></span></a>                        <span class="n">setValue</span><span class="p">(</span><span class="n">Resource</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">requestTypeApiResponse</span><span class="p">,</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getMsg</span><span class="p">(),</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getMsgType</span><span class="p">(),</span> <span class="n">responseModel</span><span class="p">.</span><span class="na">getData</span><span class="p">(),</span> <span class="n">getRequestParam</span><span class="p">()));</span>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a><a href="#__codelineno-6-50"><span class="linenos" data-linenos="50 "></span></a>                    <span class="p">}</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a><a href="#__codelineno-6-51"><span class="linenos" data-linenos="51 "></span></a>                <span class="p">}</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a><a href="#__codelineno-6-52"><span class="linenos" data-linenos="52 "></span></a>            <span class="p">}</span>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a><a href="#__codelineno-6-53"><span class="linenos" data-linenos="53 "></span></a>        <span class="p">});</span>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a><a href="#__codelineno-6-54"><span class="linenos" data-linenos="54 "></span></a>    <span class="p">}</span>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a><a href="#__codelineno-6-55"><span class="linenos" data-linenos="55 "></span></a>
<a id="__codelineno-6-56" name="__codelineno-6-56"></a><a href="#__codelineno-6-56"><span class="linenos" data-linenos="56 "></span></a>    <span class="kd">public</span> <span class="n">LiveData</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="nf">asLiveData</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-6-57" name="__codelineno-6-57"></a><a href="#__codelineno-6-57"><span class="linenos" data-linenos="57 "></span></a>        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<a id="__codelineno-6-58" name="__codelineno-6-58"></a><a href="#__codelineno-6-58"><span class="linenos" data-linenos="58 "></span></a>    <span class="p">}</span>
<a id="__codelineno-6-59" name="__codelineno-6-59"></a><a href="#__codelineno-6-59"><span class="linenos" data-linenos="59 "></span></a>
<a id="__codelineno-6-60" name="__codelineno-6-60"></a><a href="#__codelineno-6-60"><span class="linenos" data-linenos="60 "></span></a>    <span class="nd">@NonNull</span>
<a id="__codelineno-6-61" name="__codelineno-6-61"></a><a href="#__codelineno-6-61"><span class="linenos" data-linenos="61 "></span></a>    <span class="nd">@MainThread</span>
<a id="__codelineno-6-62" name="__codelineno-6-62"></a><a href="#__codelineno-6-62"><span class="linenos" data-linenos="62 "></span></a>    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">LiveData</span><span class="o">&lt;</span><span class="n">ApiResponse</span><span class="o">&lt;</span><span class="n">ResponseModel</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span> <span class="nf">createCall</span><span class="p">();</span>
<a id="__codelineno-6-63" name="__codelineno-6-63"></a><a href="#__codelineno-6-63"><span class="linenos" data-linenos="63 "></span></a>
<a id="__codelineno-6-64" name="__codelineno-6-64"></a><a href="#__codelineno-6-64"><span class="linenos" data-linenos="64 "></span></a>    <span class="kd">protected</span> <span class="n">BaseParam</span> <span class="nf">getRequestParam</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-6-65" name="__codelineno-6-65"></a><a href="#__codelineno-6-65"><span class="linenos" data-linenos="65 "></span></a>        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<a id="__codelineno-6-66" name="__codelineno-6-66"></a><a href="#__codelineno-6-66"><span class="linenos" data-linenos="66 "></span></a>    <span class="p">}</span>
<a id="__codelineno-6-67" name="__codelineno-6-67"></a><a href="#__codelineno-6-67"><span class="linenos" data-linenos="67 "></span></a><span class="p">}</span>
</code></pre></div>
<h2 id="4baserepositoryparamwrapper">4.BaseRepository.paramWrapper<a class="headerlink" href="#4baserepositoryparamwrapper" title="Anchor link to this section for reference">&para;</a></h2>
<p>这个方法是对网络请求参数进行包装， 主要是为了进行<code>md5</code>进签名，同时对通用请求数据进行排序，保证数据字符串的顺序，在进行<code>md5</code>签名校验，具体的参数如下：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">RequestParam</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">requestParam</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RequestParam</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setData</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setAppToken</span><span class="p">(</span><span class="n">appToken</span><span class="p">);</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setTime</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><a href="#__codelineno-7-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setOs</span><span class="p">(</span><span class="n">BuildConfig</span><span class="p">.</span><span class="na">OS</span><span class="p">);</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><a href="#__codelineno-7-6"><span class="linenos" data-linenos="6 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setVersion</span><span class="p">(</span><span class="n">BuildConfig</span><span class="p">.</span><span class="na">VERSION_NAME</span><span class="p">);</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><a href="#__codelineno-7-7"><span class="linenos" data-linenos="7 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setChannel</span><span class="p">(</span><span class="n">AppInfoModel</span><span class="p">.</span><span class="na">APP_CHANNEL</span><span class="p">);</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><a href="#__codelineno-7-8"><span class="linenos" data-linenos="8 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setDeviceNum</span><span class="p">(</span><span class="n">AppInfoModel</span><span class="p">.</span><span class="na">UNIQUE_ID</span><span class="p">);</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><a href="#__codelineno-7-9"><span class="linenos" data-linenos="9 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setVisitorStatus</span><span class="p">(</span><span class="n">visitorStatus</span><span class="p">);</span>
</code></pre></div>
<p>排序签名函数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos=" 1 "></span></a>        <span class="n">StringBuilder</span> <span class="n">dataStr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">();</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos=" 2 "></span></a>        <span class="k">try</span> <span class="p">{</span>            
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos=" 3 "></span></a>                        <span class="n">String</span> <span class="n">beanToJson</span> <span class="o">=</span> <span class="n">JsonUtil</span><span class="p">.</span><span class="na">beanToJson</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos=" 4 "></span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="k">instanceof</span> <span class="n">List</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><a href="#__codelineno-8-5"><span class="linenos" data-linenos=" 5 "></span></a>                <span class="n">JSONArray</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="p">(</span><span class="n">beanToJson</span><span class="p">);</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><a href="#__codelineno-8-6"><span class="linenos" data-linenos=" 6 "></span></a>                <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="na">length</span><span class="p">();</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><a href="#__codelineno-8-7"><span class="linenos" data-linenos=" 7 "></span></a>                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><a href="#__codelineno-8-8"><span class="linenos" data-linenos=" 8 "></span></a>                    <span class="n">JSONObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">array</span><span class="p">.</span><span class="na">getJSONObject</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><a href="#__codelineno-8-9"><span class="linenos" data-linenos=" 9 "></span></a>                    <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dataKeys</span> <span class="o">=</span> <span class="p">((</span><span class="n">JSONObject</span><span class="p">)</span><span class="n">obj</span><span class="p">).</span><span class="na">keys</span><span class="p">();</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><a href="#__codelineno-8-10"><span class="linenos" data-linenos="10 "></span></a>                    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dataKeyList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><a href="#__codelineno-8-11"><span class="linenos" data-linenos="11 "></span></a>                    <span class="k">while</span><span class="p">(</span><span class="n">dataKeys</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()){</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><a href="#__codelineno-8-12"><span class="linenos" data-linenos="12 "></span></a>                        <span class="n">dataKeyList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">dataKeys</span><span class="p">.</span><span class="na">next</span><span class="p">());</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><a href="#__codelineno-8-13"><span class="linenos" data-linenos="13 "></span></a>                    <span class="p">}</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><a href="#__codelineno-8-14"><span class="linenos" data-linenos="14 "></span></a>                    <span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">dataKeyList</span><span class="p">);</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a><a href="#__codelineno-8-15"><span class="linenos" data-linenos="15 "></span></a>                    <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">dataKey</span> <span class="p">:</span> <span class="n">dataKeyList</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><a href="#__codelineno-8-16"><span class="linenos" data-linenos="16 "></span></a>                        <span class="n">dataStr</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">dataKey</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">dataKey</span><span class="p">)).</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">);</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><a href="#__codelineno-8-17"><span class="linenos" data-linenos="17 "></span></a>                    <span class="p">}</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><a href="#__codelineno-8-18"><span class="linenos" data-linenos="18 "></span></a>                <span class="p">}</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><a href="#__codelineno-8-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a><a href="#__codelineno-8-20"><span class="linenos" data-linenos="20 "></span></a>                <span class="n">JSONObject</span> <span class="n">jsonObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="p">(</span><span class="n">beanToJson</span><span class="p">);</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><a href="#__codelineno-8-21"><span class="linenos" data-linenos="21 "></span></a>                <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dataKeys</span> <span class="o">=</span> <span class="n">jsonObject</span><span class="p">.</span><span class="na">keys</span><span class="p">();</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a><a href="#__codelineno-8-22"><span class="linenos" data-linenos="22 "></span></a>                <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">dataKeyList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><a href="#__codelineno-8-23"><span class="linenos" data-linenos="23 "></span></a>                <span class="k">while</span><span class="p">(</span><span class="n">dataKeys</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()){</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><a href="#__codelineno-8-24"><span class="linenos" data-linenos="24 "></span></a>                    <span class="n">dataKeyList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">dataKeys</span><span class="p">.</span><span class="na">next</span><span class="p">());</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><a href="#__codelineno-8-25"><span class="linenos" data-linenos="25 "></span></a>                <span class="p">}</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a><a href="#__codelineno-8-26"><span class="linenos" data-linenos="26 "></span></a>                <span class="n">Collections</span><span class="p">.</span><span class="na">sort</span><span class="p">(</span><span class="n">dataKeyList</span><span class="p">);</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><a href="#__codelineno-8-27"><span class="linenos" data-linenos="27 "></span></a>                <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">dataKey</span> <span class="p">:</span> <span class="n">dataKeyList</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><a href="#__codelineno-8-28"><span class="linenos" data-linenos="28 "></span></a>                    <span class="n">dataStr</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">dataKey</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">jsonObject</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">dataKey</span><span class="p">)).</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">);</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a><a href="#__codelineno-8-29"><span class="linenos" data-linenos="29 "></span></a>                <span class="p">}</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a><a href="#__codelineno-8-30"><span class="linenos" data-linenos="30 "></span></a>            <span class="p">}</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a><a href="#__codelineno-8-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">JSONException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a><a href="#__codelineno-8-32"><span class="linenos" data-linenos="32 "></span></a>            <span class="k">return</span> <span class="n">requestParam</span><span class="p">;</span>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a><a href="#__codelineno-8-33"><span class="linenos" data-linenos="33 "></span></a>        <span class="p">}</span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a><a href="#__codelineno-8-34"><span class="linenos" data-linenos="34 "></span></a>        <span class="n">String</span> <span class="n">signStr</span> <span class="o">=</span> <span class="s">&quot;os:&quot;</span><span class="o">+</span><span class="n">BuildConfig</span><span class="p">.</span><span class="na">OS</span><span class="o">+</span><span class="s">&quot;|version:&quot;</span><span class="o">+</span> <span class="n">BuildConfig</span><span class="p">.</span><span class="na">VERSION_NAME</span><span class="o">+</span><span class="s">&quot;|action:/&quot;</span><span class="o">+</span><span class="n">action</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a><a href="#__codelineno-8-35"><span class="linenos" data-linenos="35 "></span></a>                <span class="o">+</span><span class="s">&quot;|time:&quot;</span><span class="o">+</span><span class="n">requestParam</span><span class="p">.</span><span class="na">getTime</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;|appToken:&quot;</span><span class="o">+</span><span class="n">appToken</span><span class="o">+</span><span class="s">&quot;|privateKey:&quot;</span><span class="o">+</span> <span class="n">ApiURL</span><span class="p">.</span><span class="na">privateKey</span><span class="o">+</span><span class="s">&quot;|data:&quot;</span><span class="o">+</span><span class="n">dataStr</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a><a href="#__codelineno-8-36"><span class="linenos" data-linenos="36 "></span></a>        <span class="n">LogUtil</span><span class="p">.</span><span class="na">v</span><span class="p">(</span><span class="s">&quot;SignStr:&quot;</span><span class="p">,</span> <span class="n">signStr</span><span class="p">);</span>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a><a href="#__codelineno-8-37"><span class="linenos" data-linenos="37 "></span></a>        <span class="n">String</span> <span class="n">sign</span> <span class="o">=</span> <span class="n">MD5</span><span class="p">.</span><span class="na">MD5Encode</span><span class="p">(</span><span class="n">signStr</span><span class="p">);</span>
</code></pre></div>
<p>然后放到请求参数后，返回请求参数：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setSign</span><span class="p">(</span><span class="n">sign</span><span class="p">);</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><a href="#__codelineno-9-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">requestParam</span><span class="p">.</span><span class="na">setDeviceType</span><span class="p">(</span><span class="n">AppInfoModel</span><span class="p">.</span><span class="na">isTabletDevice</span> <span class="o">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><a href="#__codelineno-9-3"><span class="linenos" data-linenos="3 "></span></a><span class="k">return</span> <span class="n">requestParam</span><span class="p">;</span>
</code></pre></div>
<h2 id="5">5.小结<a class="headerlink" href="#5" title="Anchor link to this section for reference">&para;</a></h2>
<p>采用 <code>LiveData</code>的方式进行双向绑定，来进行网络请求是优点，使用比较简单，但同时高度的耦合性也对后面的扩展产生了困难，期望 在下期或者后期进行单独抽出使用，方便换引擎或者进行单点测试等（若后面可以使用协成等也有很好的扩展性），同时期望对后面的错误回调，错误重试缓存策略等，用参数方式进行配置来优化。</p>
<h2 id="6-faq">6. FAQ<a class="headerlink" href="#6-faq" title="Anchor link to this section for reference">&para;</a></h2>
<ol>
<li>为什么要对网络参数进行排序</li>
</ol>
<p>因为要和 iOS 签名算法统一，那参数就要保证一样的顺序，则采用参数排序来对参数一一入列</p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Welcome to MkDocs" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Welcome to MkDocs
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.361d90f1.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>